---
title: 専用サーバーのメンテナンス
ogImageTitle: 専用サーバーのメンテナンス
ogImageSubtitle: 専用サーバーのメンテナンス方法
---

import { Callout } from 'nextra/components';

# 専用サーバーのメンテナンス

この記事では、Zeaburに登録した[専用サーバー](../dedicated-server)のメンテナンス方法について説明します。

<Callout>
    Zeaburから専用サーバーを購入された場合、メンテナンス作業は当社が代行いたします。
    メンテナンスが必要な項目についてはチケットを作成し、スタッフにご依頼ください。
</Callout>

## ディスク容量の確保

ホストのディスク容量が不足している場合、K3sがホスト上にプルしたDockerイメージをクリーンアップすることができます（通常は自動的に実行されます）。

```bash
# 現在プルされているイメージを確認（実行不要）
$ sudo k3s crictl images

# 使用されていないイメージをすべて削除
$ sudo k3s crictl rmi --prune
```

K3sが各コンテナに対して記録しているログも、かなりの容量を占めることがあります。[K3sのlogsディレクトリ](https://docs.k3s.io/faq#where-are-the-k3s-logs)でこれらのログを清掃することができます。

## DNSネームサーバーの変更

デフォルトでは、Zeabur専用サーバーはクラスターのDNSネームサーバーとして[Cloudflare DNS](https://1.1.1.1/)を使用します（中国本土地域のマシンは[Alibaba Cloud Public DNS](https://www.alidns.com/)を使用）。

クラスターが使用するDNSネームサーバーを変更する必要がある場合（例えば、Tencentの[DNSPod Public DNS](https://www.dnspod.cn/products/publicdns)に変更する場合）、`/etc/resolv.kubelet.conf`を編集し、`nameserver`を希望するDNSネームサーバーに変更してください。

```
nameserver 119.29.29.29
```

変更後、K3sサービスを再起動することを忘れないでください。

```bash
$ sudo systemctl restart k3s
```

## Zeabur サービスの無効化

専用サーバーをお持ちの場合、すべての Zeabur サービスを停止し、VPS を Docker Compose サービスの実行など他の用途に自由に使用できます。

<Callout type="warning">
    Zeabur サービスを停止すると、Zeabur ダッシュボードからプロジェクトやサービスを作成できなくなり、Zeabur 上で稼働中のサービスも停止します。ただし、ファイアウォールルールや再起動などのサーバー設定は引き続き管理できます。なお、Zeabur からサーバーを再インストールすると、Zeabur サービスが再インストールおよび再有効化されます。
</Callout>

### Zeabur サービスを無効化する

Zeabur ダッシュボードのサイドバーにある **SSH** をクリックすると、ブラウザから直接サーバーに接続できます。ローカルのターミナルは不要です：

![Zeabur ダッシュボードから SSH 接続](/dedicated-server/server-ssh-from-dashboard.webp)

または SSH でサーバーに接続後、以下を実行します：

```bash
sudo systemctl disable --now k3s containerd
```

> 注意：これらのサービスを停止すると、サーバー上で稼働しているすべてのコンテナとサービスが停止しますのでご注意ください。

### Zeabur サービスを再有効化する

Zeabur を再び起動するには、SSH で接続後、以下を実行します：

```bash
sudo systemctl enable --now k3s containerd
```

## VS Code でリモート開発

[VS Code Remote - SSH](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh) を使用して専用サーバーに接続し、慣れ親しんだ IDE 環境で直接ファイルの編集やコンテナの操作が行えます。

### ステップ 1：Remote-SSH 拡張機能をインストール

VS Code を開き、拡張機能マーケットプレイスから **Remote - SSH** 拡張機能をインストールします。

### ステップ 2：SSH キー認証を設定

ローカルマシンで SSH キーペアを生成し（まだない場合）、公開キーをサーバーに追加します：

```bash
# ローカルマシンで SSH キーペアを生成
$ ssh-keygen -t ed25519

# 公開キーをサーバーにコピー
$ ssh-copy-id <ユーザー名>@<サーバー IP>
```

`ssh-copy-id` が使用できない場合は、手動で公開キーを追加できます：

```bash
$ cat ~/.ssh/id_ed25519.pub | ssh <ユーザー名>@<サーバー IP> "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

### ステップ 3：VS Code で接続

VS Code のコマンドパレット（`Ctrl+Shift+P` / `Cmd+Shift+P`）を開き、**Remote-SSH: Connect to Host** を選択して、`<ユーザー名>@<サーバー IP>` を入力して接続します。

### ステップ 4：サービスのファイル保存パスを特定

接続後、サーバーのルートディレクトリにいます。サービスファイルの実際の保存場所を見つけるには、まずサービスに対応する PVC（Persistent Volume Claim）を特定し、次にその PVC がバインドされている PV（Persistent Volume）とそのホストパスを取得します。

PVC 名は `<volume-id>-service-<service-id>` の形式で、Namespace は `environment-<environment-id>` です。

```bash
# すべての PVC を一覧表示して、サービスの Volume を特定
$ kubectl get pvc -A

# PVC がバインドされている PV 名を取得
$ kubectl get pvc <PVC名> -n <Namespace> -o jsonpath='{.spec.volumeName}'

# 対応する PV のホストパスを取得
$ kubectl get pv <PV名> -o jsonpath='{.spec.local.path}'
```

VS Code で **ファイル → フォルダーを開く** からこのパスを開くと、サービスファイルの編集を開始できます。

### ステップ 5：コンテナのシェルにアクセス

サービスコンテナ内のターミナル環境を取得するには（Zeabur の Web Terminal に相当）：

```bash
# 特定の Namespace の Pod を一覧表示
$ kubectl get pods -n <Namespace>

# Pod のシェルに入る
$ kubectl exec -it <Pod名> -n <Namespace> -- /bin/sh
```

## アンインストール

まず、Zeaburからサーバーとその上にデプロイされているサービスを削除する必要があります。

![サーバーの削除](/dedicated-server/remove-server.webp)

「サーバーの削除」の手順は、**Zeaburがサーバー上に設定したインフラストラクチャを削除するものではありません**。Zeaburのインフラストラクチャは主に[K3s](https://k3s.io/)上に構築されているため、アンインストールの手順は[K3sのアンインストール手順に従って](https://docs.k3s.io/installation/uninstall)行ってください。

```bash
$ /usr/local/bin/k3s-uninstall.sh
```
